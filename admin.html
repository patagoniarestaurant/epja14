<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administración - Patagonia Restaurant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root {
            --primary: #000000;
            --secondary: #d4af37;
            --accent: #000000;
            --success: #2ecc71;
            --warning: #f39c12;
            --light: #1a1a1a;
            --dark: #2c3e50;
            --text: #ffffff;
            --text-light: #b3b3b3;
            --border: #333333;
            --shadow: 0 4px 6px rgba(0,0,0,0.3);
            --gray: #666666;
            --white: #ffffff;
            --card-bg: #2d2d2d;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--primary);
            color: var(--text);
        }
        
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, var(--primary), var(--accent));
        }
        
        .login-form {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 10px;
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 400px;
            border: 1px solid var(--secondary);
        }
        
        .login-form h1 {
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--secondary);
        }
        
        .manager-signature {
            text-align: center;
            margin-top: 1.5rem;
            font-size: 1rem;
            color: var(--text-light);
            border-top: 1px solid var(--border);
            padding-top: 1rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text);
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 5px;
            font-size: 1rem;
            background-color: var(--light);
            color: var(--text);
        }
        
        .btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background-color: var(--secondary);
            color: var(--primary);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #b8941f;
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: var(--white);
            border: 1px solid var(--secondary);
        }
        
        .btn-primary:hover {
            background-color: #333333;
        }
        
        .btn-success {
            background-color: var(--success);
            color: var(--white);
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        .btn-warning {
            background-color: var(--warning);
            color: var(--white);
        }
        
        .btn-warning:hover {
            background-color: #e67e22;
        }
        
        .btn-danger {
            background-color: var(--accent);
            color: var(--white);
        }
        
        .btn-danger:hover {
            background-color: #333333;
        }
        
        .admin-container {
            display: none;
        }
        
        .admin-header {
            background-color: var(--primary);
            color: var(--white);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            border-bottom: 2px solid var(--secondary);
        }
        
        .admin-nav {
            background-color: var(--card-bg);
            padding: 1rem;
            box-shadow: var(--shadow);
            border-bottom: 2px solid var(--secondary);
        }
        
        .admin-nav ul {
            display: flex;
            list-style: none;
            gap: 1rem;
        }
        
        .admin-nav a {
            text-decoration: none;
            color: var(--text);
            padding: 0.5rem 1rem;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        
        .admin-nav a:hover, .admin-nav a.active {
            background-color: var(--secondary);
            color: var(--primary);
        }
        
        .admin-content {
            padding: 2rem;
            background-color: var(--primary);
        }
        
        .section {
            display: none;
            background: var(--card-bg);
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            border: 1px solid var(--border);
        }
        
        .section.active {
            display: block;
        }
        
        .section h2 {
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--secondary);
            color: var(--secondary);
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
            border: 1px solid var(--border);
        }
        
        .card h3 {
            margin-bottom: 1rem;
            color: var(--secondary);
            border-bottom: 1px solid var(--secondary);
            padding-bottom: 0.5rem;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .form-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        table th, table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
            color: var(--text);
        }
        
        table th {
            background-color: var(--light);
            font-weight: 600;
            color: var(--secondary);
        }
        
        .actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .actions .btn {
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
        }
        
        .image-preview {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 5px;
            margin-top: 0.5rem;
            border: 1px solid var(--border);
        }
        
        .qr-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .qr-card {
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            width: 180px;
            background-color: var(--light);
        }
        
        .qr-code {
            margin: 0 auto 1rem;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem;
            background-color: var(--success);
            color: var(--white);
            border-radius: 5px;
            box-shadow: var(--shadow);
            z-index: 1000;
            display: none;
        }
        
        .notification.error {
            background-color: var(--accent);
        }
        
        .notification.warning {
            background-color: var(--warning);
        }
        
        .customer-points {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .points-badge {
            background-color: var(--secondary);
            color: var(--primary);
            padding: 0.25rem 0.5rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .orders-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .order-item {
            padding: 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 1rem;
            background-color: var(--light);
        }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        
        .order-status {
            padding: 0.25rem 0.5rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .status-pending {
            background-color: var(--warning);
            color: var(--white);
        }
        
        .status-completed {
            background-color: var(--success);
            color: var(--white);
        }
        
        .status-cancelled {
            background-color: var(--accent);
            color: var(--white);
        }
        
        .customer-categories-editor {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .category-editor {
            flex: 1;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            background-color: var(--light);
        }
        
        .category-editor h4 {
            margin-bottom: 1rem;
            color: var(--secondary);
        }
        
        .customer-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 1rem;
        }
        
        .customer-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem;
            border-bottom: 1px solid var(--border);
        }
        
        .customer-item:last-child {
            border-bottom: none;
        }
        
        /* Estilos para el editor de imagen */
        .image-editor-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .image-editor-container {
            background-color: var(--card-bg);
            padding: 2rem;
            border-radius: 10px;
            width: 95%;
            max-width: 1000px;
            max-height: 95vh;
            overflow-y: auto;
            border: 1px solid var(--secondary);
        }
        
        .image-editor-preview {
            width: 100%;
            max-height: 500px;
            object-fit: contain;
            margin-bottom: 1rem;
            border: 1px solid var(--border);
        }
        
        .image-crop-area {
            border: 2px dashed var(--secondary);
            position: absolute;
            cursor: move;
            resize: both;
            overflow: auto;
        }
        
        .crop-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .crop-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .crop-control input {
            width: 80px;
            padding: 0.5rem;
            background-color: var(--light);
            color: var(--text);
            border: 1px solid var(--border);
            border-radius: 4px;
        }
        
        /* Estilos para categorías ordenables */
        .sortable-categories {
            list-style-type: none;
            padding: 0;
        }
        
        .sortable-category {
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background-color: var(--light);
            border: 1px solid var(--border);
            border-radius: 5px;
            cursor: move;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .sortable-category:hover {
            background-color: var(--secondary);
            color: var(--primary);
        }
        
        .sortable-category.dragging {
            opacity: 0.5;
        }
        
        /* Estilos para modal de pedidos */
        .order-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .order-modal-content {
            background-color: var(--card-bg);
            padding: 2rem;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--secondary);
        }
        
        .order-details {
            margin-bottom: 1.5rem;
        }
        
        .order-items {
            margin-bottom: 1.5rem;
        }
        
        .order-item-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border);
        }
        
        .order-total {
            font-weight: bold;
            font-size: 1.2rem;
            text-align: right;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid var(--secondary);
            color: var(--secondary);
        }
        
        /* Estilos para formulario de múltiples platos */
        .multi-dish-form {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .dish-form-group {
            border: 1px solid var(--border);
            padding: 1rem;
            border-radius: 5px;
            background-color: var(--light);
        }
        
        .dish-form-group h4 {
            margin-bottom: 0.5rem;
            color: var(--secondary);
        }
        
        .toggle-multi-dish {
            margin-bottom: 1rem;
        }
        
        /* Estilos para botones de pago en notificaciones */
        .bill-notification {
            background-color: var(--accent);
            padding: 0.5rem;
            border-radius: 5px;
            margin-top: 0.5rem;
        }
        
        /* Estilos para etiquetas de platos */
        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .tag-checkbox {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        /* Estilos para modal de edición */
        .edit-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .edit-modal-content {
            background-color: var(--card-bg);
            padding: 2rem;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--secondary);
        }
        
        /* Estilos para impresión de QR */
        .print-qr-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .print-qr-content {
            background-color: white;
            padding: 2rem;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            text-align: center;
            color: black;
        }
        
        .print-qr-content h3 {
            margin-bottom: 1rem;
            color: black;
        }
        
        .print-qr-content .qr-code {
            margin: 1rem auto;
        }
        
        @media print {
            body * {
                visibility: hidden;
            }
            .print-qr-content, .print-qr-content * {
                visibility: visible;
            }
            .print-qr-content {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <!-- Login Section -->
    <div class="login-container" id="loginSection">
        <div class="login-form">
            <h1>Panel de Administración</h1>
            <div class="form-group">
                <label for="username">Usuario</label>
                <input type="text" id="username" placeholder="Ingresa tu usuario">
            </div>
            <div class="form-group">
                <label for="password">Contraseña</label>
                <input type="password" id="password" placeholder="Ingresa tu contraseña">
            </div>
            <button class="btn btn-primary btn-block" id="loginBtn">Iniciar Sesión</button>
            <div class="manager-signature">
                GERENTE GENERAL<br>
                ARI/MBP
            </div>
        </div>
    </div>
    
    <!-- Admin Panel -->
    <div class="admin-container" id="adminPanel">
        <header class="admin-header">
            <h1>Patagonia Restaurant - Panel de Control</h1>
            <div>
                <span id="adminUser">Administrador</span>
                <button class="btn btn-danger" id="logoutBtn" style="margin-left: 1rem;">Cerrar Sesión</button>
            </div>
        </header>
        
        <nav class="admin-nav">
            <ul>
                <li><a href="#" class="nav-link active" data-section="restaurant">Información del Restaurant</a></li>
                <li><a href="#" class="nav-link" data-section="menu">Gestión de Menú</a></li>
                <li><a href="#" class="nav-link" data-section="categories">Categorías</a></li>
                <li><a href="#" class="nav-link" data-section="tables">Mesas y QR</a></li>
                <li><a href="#" class="nav-link" data-section="customers">Clientes y Fidelidad</a></li>
                <li><a href="#" class="nav-link" data-section="orders">Pedidos y Notificaciones</a></li>
                <li><a href="#" class="nav-link" data-section="top-customers">Top Clientes</a></li>
            </ul>
        </nav>
        
        <main class="admin-content">
            <!-- Restaurant Information Section -->
            <section id="restaurant" class="section active">
                <h2>Información del Restaurant</h2>
                
                <div class="card">
                    <h3>Datos Básicos</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="restaurantName">Nombre del Restaurant</label>
                            <input type="text" id="restaurantName" value="Patagonia Restaurant">
                        </div>
                        <div class="form-group">
                            <label for="restaurantSlogan">Eslogan</label>
                            <input type="text" id="restaurantSlogan" value="Sabores sin fronteras, experiencia sin límites">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="profileImage">Imagen de Perfil</label>
                            <input type="file" id="profileImage" accept="image/*">
                            <button class="btn btn-secondary" id="editProfileImage">Editar Imagen</button>
                            <img id="profilePreview" class="image-preview" src="" alt="Vista previa">
                        </div>
                        <div class="form-group">
                            <label for="coverImage">Imagen de Portada</label>
                            <input type="file" id="coverImage" accept="image/*">
                            <button class="btn btn-secondary" id="editCoverImage">Editar Imagen</button>
                            <img id="coverPreview" class="image-preview" src="" alt="Vista previa">
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" id="saveRestaurantInfo">Guardar Cambios</button>
                </div>
                
                <div class="card">
                    <h3>Información de Contacto</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="phone">Teléfono</label>
                            <input type="text" id="phone" value="+54 297 470-5984">
                        </div>
                        <div class="form-group">
                            <label for="whatsapp">WhatsApp</label>
                            <input type="text" id="whatsapp" value="+54 297 470-5984">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="instagram">Instagram</label>
                            <input type="text" id="instagram" value="@patagoniarestaurant">
                        </div>
                        <div class="form-group">
                            <label for="address">Dirección</label>
                            <input type="text" id="address" value="Domingo F. Sarmiento 494, Las Heras, Santa Cruz">
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" id="saveContactInfo">Guardar Cambios</button>
                </div>
                
                <div class="card">
                    <h3>Horarios de Atención</h3>
                    <div id="hoursContainer">
                        <!-- Horarios se generarán dinámicamente -->
                    </div>
                    <button class="btn btn-success" id="addHourBtn">Agregar Horario</button>
                    <button class="btn btn-primary" id="saveHoursBtn">Guardar Horarios</button>
                </div>
            </section>
            
            <!-- Menu Management Section -->
            <section id="menu" class="section">
                <h2>Gestión de Menú</h2>
                
                <div class="card">
                    <h3>Agregar Plato(s)</h3>
                    <div class="toggle-multi-dish">
                        <button class="btn btn-secondary" id="toggleMultiDish">Agregar Múltiples Platos (4)</button>
                    </div>
                    
                    <div id="singleDishForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="dishName">Nombre del Plato</label>
                                <input type="text" id="dishName" placeholder="Ej: Provoleta a la parrilla">
                            </div>
                            <div class="form-group">
                                <label for="dishPrice">Precio</label>
                                <input type="number" id="dishPrice" placeholder="Ej: 1200">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="dishCategory">Categoría</label>
                                <select id="dishCategory">
                                    <!-- Las categorías se llenarán dinámicamente -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="dishImage">Imagen del Plato</label>
                                <input type="file" id="dishImage" accept="image/*">
                                <button class="btn btn-secondary" id="editDishImage">Editar Imagen</button>
                                <img id="dishPreview" class="image-preview" src="" alt="Vista previa">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="dishDescription">Descripción</label>
                            <textarea id="dishDescription" rows="3" placeholder="Descripción del plato"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Etiquetas</label>
                            <div class="tags-container">
                                <div class="tag-checkbox">
                                    <input type="checkbox" id="tagVegetarian" value="vegetariano">
                                    <label for="tagVegetarian">Vegetariano</label>
                                </div>
                                <div class="tag-checkbox">
                                    <input type="checkbox" id="tagVegan" value="vegano">
                                    <label for="tagVegan">Vegano</label>
                                </div>
                                <div class="tag-checkbox">
                                    <input type="checkbox" id="tagGlutenFree" value="sin-gluten">
                                    <label for="tagGlutenFree">Sin Gluten</label>
                                </div>
                                <div class="tag-checkbox">
                                    <input type="checkbox" id="tagSpicy" value="picante">
                                    <label for="tagSpicy">Picante</label>
                                </div>
                                <div class="tag-checkbox">
                                    <input type="checkbox" id="tagLowCalorie" value="bajo-calorias">
                                    <label for="tagLowCalorie">Bajo Calorías</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="multiDishForm" style="display: none;">
                        <div class="multi-dish-form">
                            <!-- Plato 1 -->
                            <div class="dish-form-group">
                                <h4>Plato 1</h4>
                                <div class="form-group">
                                    <label>Nombre</label>
                                    <input type="text" class="multi-dish-name" placeholder="Nombre del plato">
                                </div>
                                <div class="form-group">
                                    <label>Precio</label>
                                    <input type="number" class="multi-dish-price" placeholder="Precio">
                                </div>
                                <div class="form-group">
                                    <label>Categoría</label>
                                    <select class="multi-dish-category">
                                        <!-- Las categorías se llenarán dinámicamente -->
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Imagen</label>
                                    <input type="file" class="multi-dish-image" accept="image/*">
                                    <button class="btn btn-secondary edit-multi-dish-image" data-index="0">Editar Imagen</button>
                                    <img class="multi-dish-preview image-preview" src="" alt="Vista previa" data-index="0">
                                </div>
                                <div class="form-group">
                                    <label>Descripción</label>
                                    <textarea class="multi-dish-description" rows="2" placeholder="Descripción del plato"></textarea>
                                </div>
                                <div class="form-group">
                                    <label>Etiquetas</label>
                                    <div class="tags-container">
                                        <div class="tag-checkbox">
                                            <input type="checkbox" class="multi-tag-vegetarian" value="vegetariano" data-index="0">
                                            <label>Vegetariano</label>
                                        </div>
                                        <div class="tag-checkbox">
                                            <input type="checkbox" class="multi-tag-vegan" value="vegano" data-index="0">
                                            <label>Vegano</label>
                                        </div>
                                        <div class="tag-checkbox">
                                            <input type="checkbox" class="multi-tag-gluten-free" value="sin-gluten" data-index="0">
                                            <label>Sin Gluten</label>
                                        </div>
                                        <div class="tag-checkbox">
                                            <input type="checkbox" class="multi-tag-spicy" value="picante" data-index="0">
                                            <label>Picante</label>
                                        </div>
                                        <div class="tag-checkbox">
                                            <input type="checkbox" class="multi-tag-low-calorie" value="bajo-calorias" data-index="0">
                                            <label>Bajo Calorías</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Plato 2 -->
                            <div class="dish-form-group">
                                <h4>Plato 2</h4>
                                <div class="form-group">
                                    <label>Nombre</label>
                                    <input type="text" class="multi-dish-name" placeholder="Nombre del plato">
                                </div>
                                <div class="form-group">
                                    <label>Precio</label>
                                    <input type="number" class="multi-dish-price" placeholder="Precio">
                                </div>
                                <div class="form-group">
                                    <label>Categoría</label>
                                    <select class="multi-dish-category">
                                        <!-- Las categorías se llenarán dinámicamente -->
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Imagen</label>
                                    <input type="file" class="multi-dish-image" accept="image/*">
                                    <button class="btn btn-secondary edit-multi-dish-image" data-index="1">Editar Imagen</button>
                                    <img class="multi-dish-preview image-preview" src="" alt="Vista previa" data-index="1">
                                </div>
                                <div class="form-group">
                                    <label>Descripción</label>
                                    <textarea class="multi-dish-description" rows="2" placeholder="Descripción del plato"></textarea>
                                </div>
                                <div class="form-group">
                                    <label>Etiquetas</label>
                                    <div class="tags-container">
                                        <div class="tag-checkbox">
                                            <input type="checkbox" class="multi-tag-vegetarian" value="vegetariano" data-index="1">
                                            <label>Vegetariano</label>
                                        </div>
                                        <div class="tag-checkbox">
                                            <input type="checkbox" class="multi-tag-vegan" value="vegano" data-index="1">
                                            <label>Vegano</label>
                                        </div>
                                        <div class="tag-checkbox">
                                            <input type="checkbox" class="multi-tag-gluten-free" value="sin-gluten" data-index="1">
                                            <label>Sin Gluten</label>
                                        </div>
                                        <div class="tag-checkbox">
                                            <input type="checkbox" class="multi-tag-spicy" value="picante" data-index="1">
                                            <label>Picante</label>
                                        </div>
                                        <div class="tag-checkbox">
                                            <input type="checkbox" class="multi-tag-low-calorie" value="bajo-calorias" data-index="1">
                                            <label>Bajo Calorías</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Plato 3 -->
                            <div class="dish-form-group">
                                <h4>Plato 3</h4>
                                <div class="form-group">
                                    <label>Nombre</label>
                                    <input type="text" class="multi-dish-name" placeholder="Nombre del plato">
                                </div>
                                <div class="form-group">
                                    <label>Precio</label>
                                    <input type="number" class="multi-dish-price" placeholder="Precio">
                                </div>
                                <div class="form-group">
                                    <label>Categoría</label>
                                    <select class="multi-dish-category">
                                        <!-- Las categorías se llenarán dinámicamente -->
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Imagen</label>
                                    <input type="file" class="multi-dish-image" accept="image/*">
                                    <button class="btn btn-secondary edit-multi-dish-image" data-index="2">Editar Imagen</button>
                                    <img class="multi-dish-preview image-preview" src="" alt="Vista previa" data-index="2">
                                </div>
                                <div class="form-group">
                                    <label>Descripción</label>
                                    <textarea class="multi-dish-description" rows="2" placeholder="Descripción del plato"></textarea>
                                </div>
                                <div class="form-group">
                                    <label>Etiquetas</label>
                                    <div class="tags-container">
                                        <div class="tag-checkbox">
                                            <input type="checkbox" class="multi-tag-vegetarian" value="vegetariano" data-index="2">
                                            <label>Vegetariano</label>
                                        </div>
                                        <div class="tag-checkbox">
                                            <input type="checkbox" class="multi-tag-vegan" value="vegano" data-index="2">
                                            <label>Vegano</label>
                                        </div>
                                        <div class="tag-checkbox">
                                            <input type="checkbox" class="multi-tag-gluten-free" value="sin-gluten" data-index="2">
                                            <label>Sin Gluten</label>
                                        </div>
                                        <div class="tag-checkbox">
                                            <input type="checkbox" class="multi-tag-spicy" value="picante" data-index="2">
                                            <label>Picante</label>
                                        </div>
                                        <div class="tag-checkbox">
                                            <input type="checkbox" class="multi-tag-low-calorie" value="bajo-calorias" data-index="2">
                                            <label>Bajo Calorías</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Plato 4 -->
                            <div class="dish-form-group">
                                <h4>Plato 4</h4>
                                <div class="form-group">
                                    <label>Nombre</label>
                                    <input type="text" class="multi-dish-name" placeholder="Nombre del plato">
                                </div>
                                <div class="form-group">
                                    <label>Precio</label>
                                    <input type="number" class="multi-dish-price" placeholder="Precio">
                                </div>
                                <div class="form-group">
                                    <label>Categoría</label>
                                    <select class="multi-dish-category">
                                        <!-- Las categorías se llenarán dinámicamente -->
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Imagen</label>
                                    <input type="file" class="multi-dish-image" accept="image/*">
                                    <button class="btn btn-secondary edit-multi-dish-image" data-index="3">Editar Imagen</button>
                                    <img class="multi-dish-preview image-preview" src="" alt="Vista previa" data-index="3">
                                </div>
                                <div class="form-group">
                                    <label>Descripción</label>
                                    <textarea class="multi-dish-description" rows="2" placeholder="Descripción del plato"></textarea>
                                </div>
                                <div class="form-group">
                                    <label>Etiquetas</label>
                                    <div class="tags-container">
                                        <div class="tag-checkbox">
                                            <input type="checkbox" class="multi-tag-vegetarian" value="vegetariano" data-index="3">
                                            <label>Vegetariano</label>
                                        </div>
                                        <div class="tag-checkbox">
                                            <input type="checkbox" class="multi-tag-vegan" value="vegano" data-index="3">
                                            <label>Vegano</label>
                                        </div>
                                        <div class="tag-checkbox">
                                            <input type="checkbox" class="multi-tag-gluten-free" value="sin-gluten" data-index="3">
                                            <label>Sin Gluten</label>
                                        </div>
                                        <div class="tag-checkbox">
                                            <input type="checkbox" class="multi-tag-spicy" value="picante" data-index="3">
                                            <label>Picante</label>
                                        </div>
                                        <div class="tag-checkbox">
                                            <input type="checkbox" class="multi-tag-low-calorie" value="bajo-calorias" data-index="3">
                                            <label>Bajo Calorías</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-success" id="addDishBtn">Agregar Plato(s)</button>
                </div>
                
                <div class="card">
                    <h3>Platos Existentes</h3>
                    <table id="dishesTable">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Precio</th>
                                <th>Categoría</th>
                                <th>Etiquetas</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Los platos se cargarán dinámicamente -->
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- Categories Section -->
            <section id="categories" class="section">
                <h2>Gestión de Categorías</h2>
                
                <div class="card">
                    <h3>Agregar Nueva Categoría</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="categoryName">Nombre de Categoría</label>
                            <input type="text" id="categoryName" placeholder="Ej: Postres">
                        </div>
                        <div class="form-group">
                            <label for="categoryId">ID (sin espacios)</label>
                            <input type="text" id="categoryId" placeholder="Ej: postres">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="parentCategory">Categoría Padre (opcional)</label>
                        <select id="parentCategory">
                            <option value="">Ninguna (categoría principal)</option>
                            <!-- Las categorías principales se cargarán dinámicamente -->
                        </select>
                    </div>
                    
                    <button class="btn btn-success" id="addCategoryBtn">Agregar Categoría</button>
                </div>
                
                <div class="card">
                    <h3>Categorías Existentes</h3>
                    <ul class="sortable-categories" id="sortableCategories">
                        <!-- Las categorías se cargarán dinámicamente -->
                    </ul>
                    <button class="btn btn-primary" id="saveCategoryOrder">Guardar Orden</button>
                </div>
            </section>
            
            <!-- Tables and QR Section -->
            <section id="tables" class="section">
                <h2>Gestión de Mesas y Códigos QR</h2>
                
                <div class="card">
                    <h3>Agregar Nueva Mesa</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="tableNumber">Número de Mesa</label>
                            <input type="text" id="tableNumber" placeholder="Ej: M01">
                        </div>
                        <div class="form-group">
                            <label for="tableSector">Sector</label>
                            <select id="tableSector">
                                <option value="familiar">Familiar</option>
                                <option value="parejas">Parejas</option>
                                <option value="sala-vip">Sala VIP</option>
                                <option value="terraza">Terraza</option>
                                <option value="interior">Interior</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="tableCapacity">Capacidad</label>
                        <input type="number" id="tableCapacity" placeholder="Ej: 4">
                    </div>
                    
                    <button class="btn btn-success" id="addTableBtn">Agregar Mesa</button>
                </div>
                
                <div class="card">
                    <h3>Mesas Existentes</h3>
                    <table id="tablesTable">
                        <thead>
                            <tr>
                                <th>Número</th>
                                <th>Sector</th>
                                <th>Capacidad</th>
                                <th>QR</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Las mesas se cargarán dinámicamente -->
                        </tbody>
                    </table>
                </div>
                
                <div class="card">
                    <h3>Códigos QR por Sector</h3>
                    <div class="qr-container" id="sectorQRCodes">
                        <!-- Los QR se generarán dinámicamente -->
                    </div>
                </div>
            </section>
            
            <!-- Customers and Loyalty Section -->
            <section id="customers" class="section">
                <h2>Clientes y Programa de Fidelidad</h2>
                
                <div class="card">
                    <h3>Configuración del Programa</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="pointsPerDollar">Puntos por $1 gastado</label>
                            <input type="number" id="pointsPerDollar" value="1" min="0" step="0.1">
                        </div>
                        <div class="form-group">
                            <label for="pointsForReward">Puntos necesarios para premio</label>
                            <input type="number" id="pointsForReward" value="100" min="0">
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" id="saveLoyaltyConfig">Guardar Configuración</button>
                </div>
                
                <div class="card">
                    <h3>Premios y Ofertas</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="rewardName">Nombre del Premio</label>
                            <input type="text" id="rewardName" placeholder="Ej: Postre gratis">
                        </div>
                        <div class="form-group">
                            <label for="rewardPoints">Puntos requeridos</label>
                            <input type="number" id="rewardPoints" placeholder="Ej: 100">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="rewardImage">Imagen del Premio</label>
                            <input type="file" id="rewardImage" accept="image/*">
                            <button class="btn btn-secondary" id="editRewardImage">Editar Imagen</button>
                            <img id="rewardPreview" class="image-preview" src="" alt="Vista previa">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="rewardDescription">Descripción</label>
                        <textarea id="rewardDescription" rows="2" placeholder="Descripción del premio"></textarea>
                    </div>
                    
                    <button class="btn btn-success" id="addRewardBtn">Agregar Premio</button>
                    
                    <div style="margin-top: 1.5rem;">
                        <h4>Premios Existentes</h4>
                        <table id="rewardsTable">
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Puntos</th>
                                    <th>Descripción</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Los premios se cargarán dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Clientes Registrados</h3>
                    <table id="customersTable">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Teléfono</th>
                                <th>Puntos</th>
                                <th>Premios Canjeados</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Los clientes se cargarán dinámicamente -->
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- Orders and Notifications Section -->
            <section id="orders" class="section">
                <h2>Pedidos y Notificaciones</h2>
                
                <div class="card">
                    <h3>Pedidos Activos</h3>
                    <div class="orders-list" id="activeOrders">
                        <!-- Los pedidos se cargarán dinámicamente -->
                    </div>
                </div>
                
                <div class="card">
                    <h3>Historial de Pedidos</h3>
                    <table id="ordersHistoryTable">
                        <thead>
                            <tr>
                                <th>Mesa</th>
                                <th>Cliente</th>
                                <th>Total</th>
                                <th>Fecha</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Los pedidos se cargarán dinámicamente -->
                        </tbody>
                    </table>
                </div>
                
                <div class="card">
                    <h3>Notificaciones Recientes</h3>
                    <div id="notificationsList">
                        <!-- Las notificaciones se cargarán dinámicamente -->
                    </div>
                </div>
            </section>
            
            <!-- Top Customers Section -->
            <section id="top-customers" class="section">
                <h2>Top Clientes</h2>
                
                <div class="card">
                    <h3>Configuración de Categorías de Clientes</h3>
                    <div class="customer-categories-editor">
                        <div class="category-editor">
                            <h4>Clientes Frecuentes</h4>
                            <div class="form-group">
                                <label for="frequentName">Nombre de Categoría</label>
                                <input type="text" id="frequentName" value="Clientes Frecuentes">
                            </div>
                            <div class="form-group">
                                <label for="frequentColor">Color</label>
                                <input type="color" id="frequentColor" value="#d4af37">
                            </div>
                            <div class="customer-list" id="frequentCustomers">
                                <!-- Clientes frecuentes se cargarán dinámicamente -->
                            </div>
                        </div>
                        
                        <div class="category-editor">
                            <h4>Clientes VIP</h4>
                            <div class="form-group">
                                <label for="vipName">Nombre de Categoría</label>
                                <input type="text" id="vipName" value="Clientes VIP">
                            </div>
                            <div class="form-group">
                                <label for="vipColor">Color</label>
                                <input type="color" id="vipColor" value="#c0c0c0">
                            </div>
                            <div class="customer-list" id="vipCustomers">
                                <!-- Clientes VIP se cargarán dinámicamente -->
                            </div>
                        </div>
                        
                        <div class="category-editor">
                            <h4>Nuevos Clientes</h4>
                            <div class="form-group">
                                <label for="newName">Nombre de Categoría</label>
                                <input type="text" id="newName" value="Nuevos Clientes">
                            </div>
                            <div class="form-group">
                                <label for="newColor">Color</label>
                                <input type="color" id="newColor" value="#cd7f32">
                            </div>
                            <div class="customer-list" id="newCustomers">
                                <!-- Nuevos clientes se cargarán dinámicamente -->
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" id="saveTopCustomers">Guardar Configuración</button>
                </div>
            </section>
        </main>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification"></div>
    
    <!-- Image Editor Modal -->
    <div class="image-editor-modal" id="imageEditorModal">
        <div class="image-editor-container">
            <h3>Editor de Imagen</h3>
            <p>Arrastra y redimensiona el recuadro para seleccionar la parte de la imagen que deseas mostrar</p>
            
            <div class="crop-controls">
                <div class="crop-control">
                    <label>Posición X:</label>
                    <input type="number" id="cropX" value="0" min="0">
                </div>
                <div class="crop-control">
                    <label>Posición Y:</label>
                    <input type="number" id="cropY" value="0" min="0">
                </div>
                <div class="crop-control">
                    <label>Ancho:</label>
                    <input type="number" id="cropWidth" value="200" min="50">
                </div>
                <div class="crop-control">
                    <label>Alto:</label>
                    <input type="number" id="cropHeight" value="200" min="50">
                </div>
            </div>
            
            <div style="position: relative; display: inline-block;">
                <img id="imageEditorPreview" class="image-editor-preview" src="" alt="Vista previa">
                <div id="imageCropArea" class="image-crop-area"></div>
            </div>
            <div class="form-row">
                <button class="btn btn-primary" id="saveCroppedImage">Guardar Recorte</button>
                <button class="btn btn-danger" id="cancelImageEdit">Cancelar</button>
            </div>
        </div>
    </div>
    
    <!-- Order Details Modal -->
    <div class="order-modal" id="orderModal">
        <div class="order-modal-content">
            <h3>Detalles del Pedido</h3>
            <div class="order-details" id="orderDetails">
                <!-- Los detalles del pedido se cargarán dinámicamente -->
            </div>
            <div class="order-items" id="orderItems">
                <!-- Los ítems del pedido se cargarán dinámicamente -->
            </div>
            <div class="order-total" id="orderTotal">
                <!-- El total se cargará dinámicamente -->
            </div>
            <div class="form-row">
                <button class="btn btn-success" id="markAsPaid">Marcar como Pagado</button>
                <button class="btn btn-primary" id="closeOrderModal">Cerrar</button>
            </div>
        </div>
    </div>
    
    <!-- Edit Dish Modal -->
    <div class="edit-modal" id="editDishModal">
        <div class="edit-modal-content">
            <h3>Editar Plato</h3>
            <div id="editDishForm">
                <!-- Formulario de edición se cargará dinámicamente -->
            </div>
            <div class="form-row">
                <button class="btn btn-success" id="saveDishEdit">Guardar Cambios</button>
                <button class="btn btn-danger" id="cancelDishEdit">Cancelar</button>
            </div>
        </div>
    </div>
    
    <!-- Print QR Modal -->
    <div class="print-qr-modal" id="printQRModal">
        <div class="print-qr-content">
            <h3>Código QR para Mesa</h3>
            <div id="printQRCode"></div>
            <p id="printQRInfo"></p>
            <div class="form-row">
                <button class="btn btn-primary" onclick="window.print()">Imprimir</button>
                <button class="btn btn-danger" id="closePrintQR">Cerrar</button>
            </div>
        </div>
    </div>
    
    <script>
        // Datos de ejemplo
        let adminData = {
            restaurant: {
                name: "Patagonia Restaurant",
                slogan: "Sabores sin fronteras, experiencia sin límites",
                phone: "+54 297 470-5984",
                whatsapp: "+54 297 470-5984",
                instagram: "@patagoniarestaurant",
                address: "Domingo F. Sarmiento 494, Las Heras, Santa Cruz",
                hours: [
                    {day: "Lunes", time: "Cerrado"},
                    {day: "Martes", time: "18:00 - 23:00"},
                    {day: "Miércoles", time: "18:00 - 23:00"},
                    {day: "Jueves", time: "18:00 - 23:00"},
                    {day: "Viernes", time: "18:00 - 01:00"},
                    {day: "Sábado", time: "12:00 - 01:00"},
                    {day: "Domingo", time: "12:00 - 18:00"}
                ]
            },
            categories: [
                { id: "especialidad-chef", name: "Especialidad del Chef", parent: null, order: 0 },
                { id: "platos-casa", name: "Platos de la Casa", parent: "especialidad-chef", order: 1 },
                { id: "postres-casa", name: "Postres de la Casa", parent: "especialidad-chef", order: 2 },
                { id: "principales", name: "Platos Principales", parent: null, order: 3 },
                { id: "bebidas-sin-alcohol", name: "Bebidas sin Alcohol", parent: null, order: 4 },
                { id: "acompanamientos", name: "Acompañamientos", parent: null, order: 5 },
                { id: "aperitivos", name: "Aperitivos", parent: null, order: 6 },
                { id: "postres", name: "Postres", parent: null, order: 7 },
                { id: "te-infusiones", name: "Té e Infusiones", parent: null, order: 8 },
                { id: "cafe", name: "Café", parent: null, order: 9 },
                { id: "jugos", name: "Jugos", parent: null, order: 10 },
                { id: "vinos", name: "Vinos", parent: null, order: 11 },
                { id: "tragos", name: "Tragos", parent: null, order: 12 }
            ],
            dishes: [
                { id: "d1", name: "Provoleta a la parrilla", price: 1200, category: "platos-casa", description: "Provoleta con orégano y chimichurri", tags: ["vegetariano", "sin-gluten"] },
                { id: "d2", name: "Empanadas de carne", price: 350, category: "platos-casa", description: "Empanadas tradicionales", tags: [] },
                { id: "d3", name: "Postre de la casa", price: 900, category: "postres-casa", description: "Chocolate, frutos rojos y crema", tags: ["vegetariano"] },
                { id: "d4", name: "Flan casero", price: 750, category: "postres-casa", description: "Flan con dulce de leche", tags: ["vegetariano"] },
                { id: "d5", name: "Asado Patagonia (porción)", price: 4200, category: "principales", description: "Corte seleccionado, acompañado de papas calientes", tags: [] },
                { id: "d6", name: "Salmón al horno", price: 3800, category: "principales", description: "Salmón fresco con emulsión cítrica", tags: ["bajo-calorias"] }
            ],
            tables: [
                { id: "t1", number: "M01", sector: "familiar", capacity: 6 },
                { id: "t2", number: "M02", sector: "familiar", capacity: 4 },
                { id: "t3", number: "M03", sector: "parejas", capacity: 2 },
                { id: "t4", number: "M04", sector: "sala-vip", capacity: 4 },
                { id: "t5", number: "M05", sector: "sala-vip", capacity: 6 }
            ],
            customers: [
                { id: "c1", name: "Juan Pérez", phone: "+54 9 11 1234-5678", points: 350, rewards: 2 },
                { id: "c2", name: "María García", phone: "+54 9 11 2345-6789", points: 280, rewards: 1 },
                { id: "c3", name: "Carlos López", phone: "+54 9 11 3456-7890", points: 150, rewards: 0 },
                { id: "c4", name: "Ana Martínez", phone: "+54 9 11 4567-8901", points: 420, rewards: 3 },
                { id: "c5", name: "Luis Rodríguez", phone: "+54 9 11 5678-9012", points: 90, rewards: 0 }
            ],
            rewards: [
                { id: "r1", name: "Postre gratis", points: 100, description: "Elige cualquier postre de la casa" },
                { id: "r2", name: "Bebida gratis", points: 50, description: "Elige cualquier bebida sin alcohol" },
                { id: "r3", name: "10% de descuento", points: 200, description: "10% de descuento en tu próxima visita" },
                { id: "r4", name: "Plato principal gratis", points: 300, description: "Elige cualquier plato principal" }
            ],
            orders: [
                { 
                    id: "o1", 
                    table: "M01", 
                    customer: "Juan Pérez", 
                    total: 5200, 
                    date: "2023-10-15 20:30", 
                    status: "completed",
                    items: [
                        { name: "Provoleta a la parrilla", price: 1200, quantity: 1 },
                        { name: "Asado Patagonia", price: 4200, quantity: 1 }
                    ],
                    paid: true,
                    paymentHistory: [
                        { action: "Pedido completado", date: "2023-10-15 20:30" },
                        { action: "Marcado como pagado", date: "2023-10-15 21:00" }
                    ]
                },
                { 
                    id: "o2", 
                    table: "M03", 
                    customer: "Ana Martínez", 
                    total: 3800, 
                    date: "2023-10-15 21:15", 
                    status: "pending",
                    items: [
                        { name: "Salmón al horno", price: 3800, quantity: 1 }
                    ],
                    paid: false,
                    paymentHistory: [
                        { action: "Pedido realizado", date: "2023-10-15 21:15" }
                    ]
                },
                { 
                    id: "o3", 
                    table: "M04", 
                    customer: "Carlos López", 
                    total: 6200, 
                    date: "2023-10-14 19:45", 
                    status: "completed",
                    items: [
                        { name: "Empanadas de carne", price: 350, quantity: 2 },
                        { name: "Asado Patagonia", price: 4200, quantity: 1 },
                        { name: "Flan casero", price: 750, quantity: 1 }
                    ],
                    paid: true,
                    paymentHistory: [
                        { action: "Pedido completado", date: "2023-10-14 19:45" },
                        { action: "Solicitud de cuenta", date: "2023-10-14 20:30" },
                        { action: "Marcado como pagado", date: "2023-10-14 20:35" }
                    ]
                }
            ],
            notifications: [
                { id: "n1", type: "call", table: "M02", message: "Mesa M02 está llamando al mozo", time: "2023-10-15 21:20", read: false },
                { id: "n2", type: "bill", table: "M03", message: "Mesa M03 solicitó la cuenta", time: "2023-10-15 21:05", read: true },
                { id: "n3", type: "order", table: "M01", message: "Nuevo pedido de Mesa M01", time: "2023-10-15 20:30", read: true }
            ],
            topCustomers: {
                frequent: { name: "Clientes Frecuentes", color: "#d4af37", customers: ["c1", "c4"] },
                vip: { name: "Clientes VIP", color: "#c0c0c0", customers: ["c2"] },
                new: { name: "Nuevos Clientes", color: "#cd7f32", customers: ["c3", "c5"] }
            },
            loyalty: {
                pointsPerDollar: 1,
                pointsForReward: 100
            }
        };

        // Elementos del DOM
        const loginSection = document.getElementById('loginSection');
        const adminPanel = document.getElementById('adminPanel');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const navLinks = document.querySelectorAll('.nav-link');
        const sections = document.querySelectorAll('.section');
        const notification = document.getElementById('notification');
        const imageEditorModal = document.getElementById('imageEditorModal');
        const orderModal = document.getElementById('orderModal');
        const editDishModal = document.getElementById('editDishModal');
        const printQRModal = document.getElementById('printQRModal');

        // Variables para el editor de imagen
        let currentEditingImage = null;
        let cropArea = null;
        let isDragging = false;
        let startX, startY, cropX, cropY, cropWidth, cropHeight;
        let currentEditingIndex = null;

        // Variables para edición
        let editingDishId = null;
        let editingCategoryId = null;
        let editingTableId = null;
        let editingCustomerId = null;
        let editingRewardId = null;

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            // Cargar datos desde localStorage si existen
            const savedData = localStorage.getItem('patagoniaAdminData');
            if (savedData) {
                adminData = JSON.parse(savedData);
            }
            
            // Inicializar vistas
            initRestaurantSection();
            initMenuSection();
            initCategoriesSection();
            initTablesSection();
            initCustomersSection();
            initOrdersSection();
            initTopCustomersSection();
            
            // Event Listeners
            loginBtn.addEventListener('click', handleLogin);
            logoutBtn.addEventListener('click', handleLogout);
            
            // Navegación entre secciones
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const sectionId = this.getAttribute('data-section');
                    
                    // Actualizar navegación activa
                    navLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Mostrar sección correspondiente
                    sections.forEach(section => {
                        section.classList.remove('active');
                        if (section.id === sectionId) {
                            section.classList.add('active');
                        }
                    });
                });
            });
            
            // Event Listeners para el editor de imagen
            document.getElementById('editProfileImage').addEventListener('click', function() {
                openImageEditor('profileImage', 'profilePreview');
            });
            
            document.getElementById('editCoverImage').addEventListener('click', function() {
                openImageEditor('coverImage', 'coverPreview');
            });
            
            document.getElementById('editDishImage').addEventListener('click', function() {
                openImageEditor('dishImage', 'dishPreview');
            });
            
            document.getElementById('editRewardImage').addEventListener('click', function() {
                openImageEditor('rewardImage', 'rewardPreview');
            });
            
            // Event Listeners para imágenes de platos múltiples
            document.querySelectorAll('.edit-multi-dish-image').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = this.getAttribute('data-index');
                    openMultiDishImageEditor(index);
                });
            });
            
            document.getElementById('saveCroppedImage').addEventListener('click', saveCroppedImage);
            document.getElementById('cancelImageEdit').addEventListener('click', cancelImageEdit);
            
            // Event Listeners para controles de recorte
            document.getElementById('cropX').addEventListener('input', updateCropAreaFromControls);
            document.getElementById('cropY').addEventListener('input', updateCropAreaFromControls);
            document.getElementById('cropWidth').addEventListener('input', updateCropAreaFromControls);
            document.getElementById('cropHeight').addEventListener('input', updateCropAreaFromControls);
            
            // Event Listeners para el modal de pedidos
            document.getElementById('markAsPaid').addEventListener('click', markOrderAsPaid);
            document.getElementById('closeOrderModal').addEventListener('click', function() {
                orderModal.style.display = 'none';
            });
            
            // Event Listeners para formulario múltiple de platos
            document.getElementById('toggleMultiDish').addEventListener('click', toggleMultiDishForm);
            
            // Event Listeners para modal de edición de platos
            document.getElementById('saveDishEdit').addEventListener('click', saveDishEdit);
            document.getElementById('cancelDishEdit').addEventListener('click', function() {
                editDishModal.style.display = 'none';
            });
            
            // Event Listeners para modal de impresión QR
            document.getElementById('closePrintQR').addEventListener('click', function() {
                printQRModal.style.display = 'none';
            });
            
            // Event Listeners para archivos de imágenes múltiples
            document.querySelectorAll('.multi-dish-image').forEach(input => {
                input.addEventListener('change', handleMultiDishImageUpload);
            });
            
            // Guardar datos en localStorage antes de cerrar la página
            window.addEventListener('beforeunload', function() {
                localStorage.setItem('patagoniaAdminData', JSON.stringify(adminData));
            });
        });

        // Funciones de autenticación
        function handleLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === 'ARIPEDRAZA' && password === 'ARIMBP1995') {
                loginSection.style.display = 'none';
                adminPanel.style.display = 'block';
                showNotification('Sesión iniciada correctamente', 'success');
            } else {
                showNotification('Usuario o contraseña incorrectos', 'error');
            }
        }
        
        function handleLogout() {
            loginSection.style.display = 'flex';
            adminPanel.style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            showNotification('Sesión cerrada correctamente', 'success');
        }

        // Funciones de notificación
        function showNotification(message, type = 'success') {
            notification.textContent = message;
            notification.className = 'notification';
            notification.classList.add(type);
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // Inicialización de secciones
        function initRestaurantSection() {
            // Cargar datos del restaurante
            document.getElementById('restaurantName').value = adminData.restaurant.name;
            document.getElementById('restaurantSlogan').value = adminData.restaurant.slogan;
            document.getElementById('phone').value = adminData.restaurant.phone;
            document.getElementById('whatsapp').value = adminData.restaurant.whatsapp;
            document.getElementById('instagram').value = adminData.restaurant.instagram;
            document.getElementById('address').value = adminData.restaurant.address;
            
            // Cargar horarios
            const hoursContainer = document.getElementById('hoursContainer');
            hoursContainer.innerHTML = '';
            
            adminData.restaurant.hours.forEach((hour, index) => {
                const hourDiv = document.createElement('div');
                hourDiv.className = 'form-row';
                hourDiv.innerHTML = `
                    <div class="form-group">
                        <label>Día</label>
                        <input type="text" class="hour-day" value="${hour.day}" data-index="${index}">
                    </div>
                    <div class="form-group">
                        <label>Horario</label>
                        <input type="text" class="hour-time" value="${hour.time}" data-index="${index}">
                    </div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button class="btn btn-danger remove-hour" data-index="${index}">Eliminar</button>
                    </div>
                `;
                hoursContainer.appendChild(hourDiv);
            });
            
            // Event Listeners para la sección de restaurante
            document.getElementById('saveRestaurantInfo').addEventListener('click', saveRestaurantInfo);
            document.getElementById('saveContactInfo').addEventListener('click', saveContactInfo);
            document.getElementById('addHourBtn').addEventListener('click', addHour);
            document.getElementById('saveHoursBtn').addEventListener('click', saveHours);
            
            // Event Listeners para eliminar horarios
            document.querySelectorAll('.remove-hour').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    adminData.restaurant.hours.splice(index, 1);
                    initRestaurantSection();
                    showNotification('Horario eliminado', 'success');
                });
            });
            
            // Manejo de imágenes
            document.getElementById('profileImage').addEventListener('change', handleImageUpload);
            document.getElementById('coverImage').addEventListener('change', handleImageUpload);
        }
        
        function initMenuSection() {
            // Cargar categorías en el selector
            const categorySelect = document.getElementById('dishCategory');
            categorySelect.innerHTML = '';
            
            // Ordenar categorías por el campo 'order'
            const sortedCategories = [...adminData.categories].sort((a, b) => a.order - b.order);
            
            sortedCategories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = category.name;
                categorySelect.appendChild(option);
            });
            
            // Cargar categorías en formulario múltiple
            const multiCategorySelects = document.querySelectorAll('.multi-dish-category');
            multiCategorySelects.forEach(select => {
                select.innerHTML = '';
                sortedCategories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = category.name;
                    select.appendChild(option);
                });
            });
            
            // Cargar tabla de platos
            const dishesTable = document.getElementById('dishesTable').querySelector('tbody');
            dishesTable.innerHTML = '';
            
            adminData.dishes.forEach(dish => {
                const category = adminData.categories.find(c => c.id === dish.category);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${dish.name}</td>
                    <td>$${dish.price}</td>
                    <td>${category ? category.name : 'N/A'}</td>
                    <td>${dish.tags.join(', ')}</td>
                    <td class="actions">
                        <button class="btn btn-warning edit-dish" data-id="${dish.id}">Editar</button>
                        <button class="btn btn-danger delete-dish" data-id="${dish.id}">Eliminar</button>
                    </td>
                `;
                dishesTable.appendChild(row);
            });
            
            // Event Listeners para la sección de menú
            document.getElementById('addDishBtn').addEventListener('click', addDish);
            document.getElementById('dishImage').addEventListener('change', handleDishImageUpload);
            
            // Event Listeners para editar/eliminar platos
            document.querySelectorAll('.edit-dish').forEach(btn => {
                btn.addEventListener('click', function() {
                    const dishId = this.getAttribute('data-id');
                    editDish(dishId);
                });
            });
            
            document.querySelectorAll('.delete-dish').forEach(btn => {
                btn.addEventListener('click', function() {
                    const dishId = this.getAttribute('data-id');
                    deleteDish(dishId);
                });
            });
        }
        
        function initCategoriesSection() {
            // Cargar categorías padre en el selector
            const parentSelect = document.getElementById('parentCategory');
            parentSelect.innerHTML = '<option value="">Ninguna (categoría principal)</option>';
            
            adminData.categories
                .filter(category => category.parent === null)
                .forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = category.name;
                    parentSelect.appendChild(option);
                });
            
            // Cargar lista ordenable de categorías
            const sortableCategories = document.getElementById('sortableCategories');
            sortableCategories.innerHTML = '';
            
            // Ordenar categorías por el campo 'order'
            const sortedCategories = [...adminData.categories].sort((a, b) => a.order - b.order);
            
            sortedCategories.forEach(category => {
                const parent = adminData.categories.find(c => c.id === category.parent);
                const categoryItem = document.createElement('li');
                categoryItem.className = 'sortable-category';
                categoryItem.setAttribute('data-id', category.id);
                categoryItem.innerHTML = `
                    <span>${category.name} (${category.id})</span>
                    <span>${parent ? parent.name : 'Principal'}</span>
                    <div class="actions">
                        <button class="btn btn-warning edit-category" data-id="${category.id}">Editar</button>
                        <button class="btn btn-danger delete-category" data-id="${category.id}">Eliminar</button>
                    </div>
                `;
                sortableCategories.appendChild(categoryItem);
            });
            
            // Hacer las categorías arrastrables
            makeCategoriesSortable();
            
            // Event Listeners para la sección de categorías
            document.getElementById('addCategoryBtn').addEventListener('click', addCategory);
            document.getElementById('saveCategoryOrder').addEventListener('click', saveCategoryOrder);
            
            // Event Listeners para editar/eliminar categorías
            document.querySelectorAll('.edit-category').forEach(btn => {
                btn.addEventListener('click', function() {
                    const categoryId = this.getAttribute('data-id');
                    editCategory(categoryId);
                });
            });
            
            document.querySelectorAll('.delete-category').forEach(btn => {
                btn.addEventListener('click', function() {
                    const categoryId = this.getAttribute('data-id');
                    deleteCategory(categoryId);
                });
            });
        }
        
        function initTablesSection() {
            // Cargar tabla de mesas
            const tablesTable = document.getElementById('tablesTable').querySelector('tbody');
            tablesTable.innerHTML = '';
            
            adminData.tables.forEach(table => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${table.number}</td>
                    <td>${table.sector}</td>
                    <td>${table.capacity} personas</td>
                    <td>
                        <button class="btn btn-primary generate-qr" data-id="${table.id}">Generar QR</button>
                    </td>
                    <td class="actions">
                        <button class="btn btn-warning edit-table" data-id="${table.id}">Editar</button>
                        <button class="btn btn-danger delete-table" data-id="${table.id}">Eliminar</button>
                    </td>
                `;
                tablesTable.appendChild(row);
            });
            
            // Generar QR por sector
            generateSectorQRs();
            
            // Event Listeners para la sección de mesas
            document.getElementById('addTableBtn').addEventListener('click', addTable);
            
            // Event Listeners para generar QR, editar/eliminar mesas
            document.querySelectorAll('.generate-qr').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tableId = this.getAttribute('data-id');
                    generateTableQR(tableId);
                });
            });
            
            document.querySelectorAll('.edit-table').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tableId = this.getAttribute('data-id');
                    editTable(tableId);
                });
            });
            
            document.querySelectorAll('.delete-table').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tableId = this.getAttribute('data-id');
                    deleteTable(tableId);
                });
            });
        }
        
        function initCustomersSection() {
            // Cargar configuración de fidelidad
            document.getElementById('pointsPerDollar').value = adminData.loyalty.pointsPerDollar;
            document.getElementById('pointsForReward').value = adminData.loyalty.pointsForReward;
            
            // Cargar tabla de premios
            const rewardsTable = document.getElementById('rewardsTable').querySelector('tbody');
            rewardsTable.innerHTML = '';
            
            adminData.rewards.forEach(reward => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${reward.name}</td>
                    <td>${reward.points}</td>
                    <td>${reward.description}</td>
                    <td class="actions">
                        <button class="btn btn-warning edit-reward" data-id="${reward.id}">Editar</button>
                        <button class="btn btn-danger delete-reward" data-id="${reward.id}">Eliminar</button>
                    </td>
                `;
                rewardsTable.appendChild(row);
            });
            
            // Cargar tabla de clientes
            const customersTable = document.getElementById('customersTable').querySelector('tbody');
            customersTable.innerHTML = '';
            
            adminData.customers.forEach(customer => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customer.name}</td>
                    <td>${customer.phone}</td>
                    <td class="customer-points">
                        <span class="points-badge">${customer.points} pts</span>
                    </td>
                    <td>${customer.rewards}</td>
                    <td class="actions">
                        <button class="btn btn-warning edit-customer" data-id="${customer.id}">Editar</button>
                        <button class="btn btn-danger delete-customer" data-id="${customer.id}">Eliminar</button>
                    </td>
                `;
                customersTable.appendChild(row);
            });
            
            // Event Listeners para la sección de clientes
            document.getElementById('saveLoyaltyConfig').addEventListener('click', saveLoyaltyConfig);
            document.getElementById('addRewardBtn').addEventListener('click', addReward);
            document.getElementById('rewardImage').addEventListener('change', handleRewardImageUpload);
            
            // Event Listeners para editar/eliminar premios y clientes
            document.querySelectorAll('.edit-reward').forEach(btn => {
                btn.addEventListener('click', function() {
                    const rewardId = this.getAttribute('data-id');
                    editReward(rewardId);
                });
            });
            
            document.querySelectorAll('.delete-reward').forEach(btn => {
                btn.addEventListener('click', function() {
                    const rewardId = this.getAttribute('data-id');
                    deleteReward(rewardId);
                });
            });
            
            document.querySelectorAll('.edit-customer').forEach(btn => {
                btn.addEventListener('click', function() {
                    const customerId = this.getAttribute('data-id');
                    editCustomer(customerId);
                });
            });
            
            document.querySelectorAll('.delete-customer').forEach(btn => {
                btn.addEventListener('click', function() {
                    const customerId = this.getAttribute('data-id');
                    deleteCustomer(customerId);
                });
            });
        }
        
        function initOrdersSection() {
            // Cargar pedidos activos
            const activeOrders = document.getElementById('activeOrders');
            activeOrders.innerHTML = '';
            
            const pendingOrders = adminData.orders.filter(order => order.status === 'pending');
            
            if (pendingOrders.length === 0) {
                activeOrders.innerHTML = '<p>No hay pedidos activos en este momento.</p>';
            } else {
                pendingOrders.forEach(order => {
                    const orderItem = document.createElement('div');
                    orderItem.className = 'order-item';
                    orderItem.innerHTML = `
                        <div class="order-header">
                            <h4>Mesa ${order.table} - ${order.customer}</h4>
                            <span class="order-status status-pending">Pendiente</span>
                        </div>
                        <p><strong>Total:</strong> $${order.total}</p>
                        <p><strong>Fecha:</strong> ${order.date}</p>
                        <div class="actions" style="margin-top: 0.5rem;">
                            <button class="btn btn-success complete-order" data-id="${order.id}">Completar</button>
                            <button class="btn btn-danger cancel-order" data-id="${order.id}">Cancelar</button>
                        </div>
                    `;
                    activeOrders.appendChild(orderItem);
                });
            }
            
            // Cargar historial de pedidos
            const ordersHistoryTable = document.getElementById('ordersHistoryTable').querySelector('tbody');
            ordersHistoryTable.innerHTML = '';
            
            adminData.orders.forEach(order => {
                const statusClass = order.status === 'completed' ? 'status-completed' : 
                                  order.status === 'cancelled' ? 'status-cancelled' : 'status-pending';
                const statusText = order.status === 'completed' ? 'Completado' : 
                                 order.status === 'cancelled' ? 'Cancelado' : 'Pendiente';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${order.table}</td>
                    <td>${order.customer}</td>
                    <td>$${order.total}</td>
                    <td>${order.date}</td>
                    <td><span class="order-status ${statusClass}">${statusText}</span></td>
                    <td class="actions">
                        <button class="btn btn-primary view-order" data-id="${order.id}">Ver</button>
                        ${!order.paid ? '<button class="btn btn-success mark-paid" data-id="' + order.id + '">Marcar Pagado</button>' : ''}
                    </td>
                `;
                ordersHistoryTable.appendChild(row);
            });
            
            // Cargar notificaciones
            const notificationsList = document.getElementById('notificationsList');
            notificationsList.innerHTML = '';
            
            adminData.notifications.forEach(notification => {
                const notificationItem = document.createElement('div');
                notificationItem.className = 'order-item';
                
                let extraContent = '';
                if (notification.type === 'bill') {
                    extraContent = `
                        <div class="bill-notification">
                            <p><strong>Solicitud de pago</strong></p>
                            <button class="btn btn-success mark-bill-paid" data-id="${notification.id}">Marcar como Pagado</button>
                        </div>
                    `;
                }
                
                notificationItem.innerHTML = `
                    <div class="order-header">
                        <h4>${notification.type === 'call' ? 'Llamada al mozo' : 
                              notification.type === 'bill' ? 'Solicitud de cuenta' : 
                              'Nuevo pedido'}</h4>
                        <span style="font-size: 0.875rem; color: var(--text-light);">${notification.time}</span>
                    </div>
                    <p>${notification.message}</p>
                    ${extraContent}
                    ${!notification.read ? '<button class="btn btn-primary mark-read" data-id="' + notification.id + '">Marcar como leído</button>' : ''}
                `;
                notificationsList.appendChild(notificationItem);
            });
            
            // Event Listeners para la sección de pedidos
            document.querySelectorAll('.complete-order').forEach(btn => {
                btn.addEventListener('click', function() {
                    const orderId = this.getAttribute('data-id');
                    completeOrder(orderId);
                });
            });
            
            document.querySelectorAll('.cancel-order').forEach(btn => {
                btn.addEventListener('click', function() {
                    const orderId = this.getAttribute('data-id');
                    cancelOrder(orderId);
                });
            });
            
            document.querySelectorAll('.view-order').forEach(btn => {
                btn.addEventListener('click', function() {
                    const orderId = this.getAttribute('data-id');
                    viewOrder(orderId);
                });
            });
            
            document.querySelectorAll('.mark-paid').forEach(btn => {
                btn.addEventListener('click', function() {
                    const orderId = this.getAttribute('data-id');
                    markOrderAsPaidInTable(orderId);
                });
            });
            
            document.querySelectorAll('.mark-bill-paid').forEach(btn => {
                btn.addEventListener('click', function() {
                    const notificationId = this.getAttribute('data-id');
                    markBillAsPaid(notificationId);
                });
            });
            
            document.querySelectorAll('.mark-read').forEach(btn => {
                btn.addEventListener('click', function() {
                    const notificationId = this.getAttribute('data-id');
                    markNotificationAsRead(notificationId);
                });
            });
        }
        
        function initTopCustomersSection() {
            // Cargar configuración de top clientes
            document.getElementById('frequentName').value = adminData.topCustomers.frequent.name;
            document.getElementById('frequentColor').value = adminData.topCustomers.frequent.color;
            document.getElementById('vipName').value = adminData.topCustomers.vip.name;
            document.getElementById('vipColor').value = adminData.topCustomers.vip.color;
            document.getElementById('newName').value = adminData.topCustomers.new.name;
            document.getElementById('newColor').value = adminData.topCustomers.new.color;
            
            // Cargar listas de clientes
            loadCustomerList('frequentCustomers', adminData.topCustomers.frequent.customers);
            loadCustomerList('vipCustomers', adminData.topCustomers.vip.customers);
            loadCustomerList('newCustomers', adminData.topCustomers.new.customers);
            
            // Event Listeners para la sección de top clientes
            document.getElementById('saveTopCustomers').addEventListener('click', saveTopCustomers);
        }
        
        // Funciones auxiliares para cargar listas de clientes
        function loadCustomerList(containerId, customerIds) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            customerIds.forEach(customerId => {
                const customer = adminData.customers.find(c => c.id === customerId);
                if (customer) {
                    const customerItem = document.createElement('div');
                    customerItem.className = 'customer-item';
                    customerItem.innerHTML = `
                        <span>${customer.name}</span>
                        <span class="points-badge">${customer.points} pts</span>
                    `;
                    container.appendChild(customerItem);
                }
            });
        }
        
        // Funciones para generar QR
        function generateSectorQRs() {
            const sectorQRCodes = document.getElementById('sectorQRCodes');
            sectorQRCodes.innerHTML = '';
            
            const sectors = [...new Set(adminData.tables.map(table => table.sector))];
            
            sectors.forEach(sector => {
                const qrCard = document.createElement('div');
                qrCard.className = 'qr-card';
                
                const qrContainer = document.createElement('div');
                qrContainer.id = `qr-${sector}`;
                qrContainer.className = 'qr-code';
                
                qrCard.appendChild(qrContainer);
                qrCard.innerHTML += `<h4>Sector ${sector}</h4>`;
                qrCard.innerHTML += `<p>Escanea para acceder al menú</p>`;
                
                sectorQRCodes.appendChild(qrCard);
                
                // Generar QR
                new QRCode(qrContainer, {
                    text: `https://patagoniarestaurant.com/menu?sector=${sector}`,
                    width: 128,
                    height: 128
                });
            });
        }
        
        function generateTableQR(tableId) {
            const table = adminData.tables.find(t => t.id === tableId);
            if (!table) return;
            
            // Limpiar contenido anterior
            const printQRCode = document.getElementById('printQRCode');
            printQRCode.innerHTML = '';
            
            const printQRInfo = document.getElementById('printQRInfo');
            printQRInfo.textContent = `Mesa: ${table.number} | Sector: ${table.sector} | Capacidad: ${table.capacity} personas`;
            
            // Generar QR con URL única para la mesa
            new QRCode(printQRCode, {
                text: `https://patagoniarestaurant.com/menu?table=${table.number}&sector=${table.sector}&id=${table.id}`,
                width: 200,
                height: 200
            });
            
            // Mostrar modal de impresión
            printQRModal.style.display = 'flex';
        }
        
        // Funciones para manejar imágenes
        function handleImageUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                const previewId = e.target.id === 'profileImage' ? 'profilePreview' : 'coverPreview';
                document.getElementById(previewId).src = event.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        function handleDishImageUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                document.getElementById('dishPreview').src = event.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        function handleRewardImageUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                document.getElementById('rewardPreview').src = event.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        function handleMultiDishImageUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const index = Array.from(document.querySelectorAll('.multi-dish-image')).indexOf(e.target);
            const reader = new FileReader();
            reader.onload = function(event) {
                const preview = document.querySelector(`.multi-dish-preview[data-index="${index}"]`);
                preview.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        // Funciones para el editor de imagen
        function openImageEditor(inputId, previewId) {
            const input = document.getElementById(inputId);
            if (!input.files || !input.files[0]) {
                showNotification('Primero selecciona una imagen', 'error');
                return;
            }
            
            const file = input.files[0];
            const reader = new FileReader();
            
            reader.onload = function(event) {
                currentEditingImage = {
                    inputId: inputId,
                    previewId: previewId,
                    src: event.target.result
                };
                
                document.getElementById('imageEditorPreview').src = event.target.result;
                imageEditorModal.style.display = 'flex';
                
                // Inicializar área de recorte
                initCropArea();
            };
            
            reader.readAsDataURL(file);
        }
        
        function openMultiDishImageEditor(index) {
            const inputs = document.querySelectorAll('.multi-dish-image');
            const input = inputs[index];
            
            if (!input.files || !input.files[0]) {
                showNotification('Primero selecciona una imagen', 'error');
                return;
            }
            
            const file = input.files[0];
            const reader = new FileReader();
            
            reader.onload = function(event) {
                currentEditingImage = {
                    inputId: null,
                    previewId: null,
                    src: event.target.result,
                    multiIndex: index
                };
                
                document.getElementById('imageEditorPreview').src = event.target.result;
                imageEditorModal.style.display = 'flex';
                
                // Inicializar área de recorte
                initCropArea();
            };
            
            reader.readAsDataURL(file);
        }
        
        function initCropArea() {
            const preview = document.getElementById('imageEditorPreview');
            const container = preview.parentElement;
            
            // Crear área de recorte si no existe
            if (!cropArea) {
                cropArea = document.getElementById('imageCropArea');
                
                // Event listeners para arrastrar
                cropArea.addEventListener('mousedown', startDrag);
                document.addEventListener('mousemove', drag);
                document.addEventListener('mouseup', stopDrag);
                
                cropArea.addEventListener('touchstart', startDrag);
                document.addEventListener('touchmove', drag);
                document.addEventListener('touchend', stopDrag);
            }
            
            // Configurar tamaño inicial del área de recorte
            const previewWidth = preview.clientWidth;
            const previewHeight = preview.clientHeight;
            
            cropWidth = Math.min(previewWidth, previewHeight) * 0.6;
            cropHeight = cropWidth;
            
            cropX = (previewWidth - cropWidth) / 2;
            cropY = (previewHeight - cropHeight) / 2;
            
            updateCropArea();
            updateCropControls();
        }
        
        function startDrag(e) {
            isDragging = true;
            const clientX = e.clientX || e.touches[0].clientX;
            const clientY = e.clientY || e.touches[0].clientY;
            
            startX = clientX - cropX;
            startY = clientY - cropY;
            
            e.preventDefault();
        }
        
        function drag(e) {
            if (!isDragging) return;
            
            const clientX = e.clientX || e.touches[0].clientX;
            const clientY = e.clientY || e.touches[0].clientY;
            
            const preview = document.getElementById('imageEditorPreview');
            const container = preview.parentElement;
            const containerRect = container.getBoundingClientRect();
            
            cropX = clientX - startX - containerRect.left;
            cropY = clientY - startY - containerRect.top;
            
            // Limitar el movimiento dentro de la imagen
            cropX = Math.max(0, Math.min(preview.clientWidth - cropWidth, cropX));
            cropY = Math.max(0, Math.min(preview.clientHeight - cropHeight, cropY));
            
            updateCropArea();
            updateCropControls();
            e.preventDefault();
        }
        
        function stopDrag() {
            isDragging = false;
        }
        
        function updateCropArea() {
            if (!cropArea) return;
            
            cropArea.style.left = cropX + 'px';
            cropArea.style.top = cropY + 'px';
            cropArea.style.width = cropWidth + 'px';
            cropArea.style.height = cropHeight + 'px';
        }
        
        function updateCropControls() {
            document.getElementById('cropX').value = Math.round(cropX);
            document.getElementById('cropY').value = Math.round(cropY);
            document.getElementById('cropWidth').value = Math.round(cropWidth);
            document.getElementById('cropHeight').value = Math.round(cropHeight);
        }
        
        function updateCropAreaFromControls() {
            const preview = document.getElementById('imageEditorPreview');
            
            cropX = parseInt(document.getElementById('cropX').value) || 0;
            cropY = parseInt(document.getElementById('cropY').value) || 0;
            cropWidth = parseInt(document.getElementById('cropWidth').value) || 200;
            cropHeight = parseInt(document.getElementById('cropHeight').value) || 200;
            
            // Limitar valores dentro de la imagen
            cropX = Math.max(0, Math.min(preview.clientWidth - cropWidth, cropX));
            cropY = Math.max(0, Math.min(preview.clientHeight - cropHeight, cropY));
            cropWidth = Math.max(50, Math.min(preview.clientWidth - cropX, cropWidth));
            cropHeight = Math.max(50, Math.min(preview.clientHeight - cropY, cropHeight));
            
            updateCropArea();
        }
        
        function saveCroppedImage() {
            if (!currentEditingImage) return;
            
            const preview = document.getElementById('imageEditorPreview');
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Calcular factores de escala
            const naturalWidth = preview.naturalWidth;
            const naturalHeight = preview.naturalHeight;
            const displayedWidth = preview.clientWidth;
            const displayedHeight = preview.clientHeight;
            
            const scaleX = naturalWidth / displayedWidth;
            const scaleY = naturalHeight / displayedHeight;
            
            // Configurar canvas con las dimensiones del área de recorte
            canvas.width = cropWidth * scaleX;
            canvas.height = cropHeight * scaleY;
            
            // Dibujar la parte recortada en el canvas
            ctx.drawImage(
                preview,
                cropX * scaleX, cropY * scaleY, // Coordenadas de origen
                cropWidth * scaleX, cropHeight * scaleY, // Dimensiones de origen
                0, 0, // Coordenadas de destino
                cropWidth * scaleX, cropHeight * scaleY // Dimensiones de destino
            );
            
            // Convertir a data URL y actualizar la vista previa
            const croppedDataURL = canvas.toDataURL();
            
            if (currentEditingImage.multiIndex !== undefined) {
                // Es una imagen de plato múltiple
                const preview = document.querySelector(`.multi-dish-preview[data-index="${currentEditingImage.multiIndex}"]`);
                preview.src = croppedDataURL;
            } else {
                // Es una imagen normal
                document.getElementById(currentEditingImage.previewId).src = croppedDataURL;
            }
            
            // Cerrar el editor
            imageEditorModal.style.display = 'none';
            showNotification('Imagen recortada y guardada', 'success');
        }
        
        function cancelImageEdit() {
            imageEditorModal.style.display = 'none';
            currentEditingImage = null;
        }
        
        // Funciones para categorías ordenables
        function makeCategoriesSortable() {
            const sortableList = document.getElementById('sortableCategories');
            let draggedItem = null;
            
            sortableList.addEventListener('dragstart', function(e) {
                draggedItem = e.target.closest('.sortable-category');
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/html', draggedItem.outerHTML);
                
                setTimeout(() => {
                    draggedItem.classList.add('dragging');
                }, 0);
            });
            
            sortableList.addEventListener('dragover', function(e) {
                e.preventDefault();
                const afterElement = getDragAfterElement(sortableList, e.clientY);
                const draggable = document.querySelector('.dragging');
                
                if (afterElement == null) {
                    sortableList.appendChild(draggable);
                } else {
                    sortableList.insertBefore(draggable, afterElement);
                }
            });
            
            sortableList.addEventListener('dragend', function(e) {
                draggedItem.classList.remove('dragging');
                draggedItem = null;
            });
        }
        
        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.sortable-category:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }
        
        function saveCategoryOrder() {
            const categoriesList = document.getElementById('sortableCategories');
            const categories = categoriesList.querySelectorAll('.sortable-category');
            
            categories.forEach((category, index) => {
                const categoryId = category.getAttribute('data-id');
                const categoryData = adminData.categories.find(c => c.id === categoryId);
                if (categoryData) {
                    categoryData.order = index;
                }
            });
            
            showNotification('Orden de categorías guardado', 'success');
        }
        
        // Funciones para formulario múltiple de platos
        function toggleMultiDishForm() {
            const singleForm = document.getElementById('singleDishForm');
            const multiForm = document.getElementById('multiDishForm');
            const toggleBtn = document.getElementById('toggleMultiDish');
            
            if (multiForm.style.display === 'none') {
                singleForm.style.display = 'none';
                multiForm.style.display = 'block';
                toggleBtn.textContent = 'Agregar Plato Individual';
            } else {
                singleForm.style.display = 'block';
                multiForm.style.display = 'none';
                toggleBtn.textContent = 'Agregar Múltiples Platos (4)';
            }
        }
        
        // Funciones para pedidos
        function viewOrder(orderId) {
            const order = adminData.orders.find(o => o.id === orderId);
            if (!order) return;
            
            const orderDetails = document.getElementById('orderDetails');
            const orderItems = document.getElementById('orderItems');
            const orderTotal = document.getElementById('orderTotal');
            
            // Limpiar contenido anterior
            orderDetails.innerHTML = '';
            orderItems.innerHTML = '';
            orderTotal.innerHTML = '';
            
            // Mostrar detalles del pedido
            orderDetails.innerHTML = `
                <p><strong>Mesa:</strong> ${order.table}</p>
                <p><strong>Cliente:</strong> ${order.customer}</p>
                <p><strong>Fecha:</strong> ${order.date}</p>
                <p><strong>Estado:</strong> ${order.status === 'completed' ? 'Completado' : order.status === 'cancelled' ? 'Cancelado' : 'Pendiente'}</p>
                <p><strong>Pagado:</strong> ${order.paid ? 'Sí' : 'No'}</p>
            `;
            
            // Mostrar ítems del pedido
            orderItems.innerHTML = '<h4>Consumo del Cliente:</h4>';
            order.items.forEach(item => {
                const itemRow = document.createElement('div');
                itemRow.className = 'order-item-row';
                itemRow.innerHTML = `
                    <span>${item.name} x${item.quantity}</span>
                    <span>$${item.price * item.quantity}</span>
                `;
                orderItems.appendChild(itemRow);
            });
            
            // Mostrar historial de pagos si existe
            if (order.paymentHistory && order.paymentHistory.length > 0) {
                const paymentHistory = document.createElement('div');
                paymentHistory.style.marginTop = '1rem';
                paymentHistory.innerHTML = '<h4>Historial de Pagos:</h4>';
                
                order.paymentHistory.forEach(payment => {
                    const paymentItem = document.createElement('div');
                    paymentItem.className = 'order-item-row';
                    paymentItem.innerHTML = `
                        <span>${payment.action}</span>
                        <span>${payment.date}</span>
                    `;
                    paymentHistory.appendChild(paymentItem);
                });
                
                orderItems.appendChild(paymentHistory);
            }
            
            // Mostrar total
            orderTotal.innerHTML = `<strong>Total: $${order.total}</strong>`;
            
            // Configurar el botón de pagado
            const markAsPaidBtn = document.getElementById('markAsPaid');
            if (order.paid) {
                markAsPaidBtn.disabled = true;
                markAsPaidBtn.textContent = 'Ya Pagado';
            } else {
                markAsPaidBtn.disabled = false;
                markAsPaidBtn.textContent = 'Marcar como Pagado';
                markAsPaidBtn.setAttribute('data-order-id', orderId);
            }
            
            // Mostrar modal
            orderModal.style.display = 'flex';
        }
        
        function markOrderAsPaid() {
            const orderId = this.getAttribute('data-order-id');
            markOrderAsPaidInTable(orderId);
            orderModal.style.display = 'none';
        }
        
        function markOrderAsPaidInTable(orderId) {
            const order = adminData.orders.find(o => o.id === orderId);
            if (order) {
                order.paid = true;
                
                // Agregar entrada al historial de pagos
                if (!order.paymentHistory) {
                    order.paymentHistory = [];
                }
                order.paymentHistory.push({
                    action: "Marcado como pagado desde historial",
                    date: new Date().toLocaleString()
                });
                
                // Si el cliente está registrado, agregar puntos
                const customer = adminData.customers.find(c => c.name === order.customer);
                if (customer) {
                    const pointsToAdd = Math.floor(order.total * adminData.loyalty.pointsPerDollar);
                    customer.points += pointsToAdd;
                    showNotification(`Pedido marcado como pagado. ${pointsToAdd} puntos agregados a ${customer.name}`, 'success');
                } else {
                    showNotification('Pedido marcado como pagado', 'success');
                }
                
                initOrdersSection();
            }
        }
        
        function markBillAsPaid(notificationId) {
            const notification = adminData.notifications.find(n => n.id === notificationId);
            if (notification) {
                // Buscar la mesa en la notificación
                const tableNumber = notification.table;
                
                // Buscar pedidos pendientes para esa mesa
                const pendingOrders = adminData.orders.filter(order => 
                    order.table === tableNumber && order.status === 'pending' && !order.paid
                );
                
                // Marcar todos los pedidos pendientes de esa mesa como pagados
                pendingOrders.forEach(order => {
                    order.paid = true;
                    
                    // Agregar entrada al historial de pagos
                    if (!order.paymentHistory) {
                        order.paymentHistory = [];
                    }
                    order.paymentHistory.push({
                        action: "Solicitud de cuenta pagada desde notificaciones",
                        date: new Date().toLocaleString()
                    });
                    
                    // Si el cliente está registrado, agregar puntos
                    const customer = adminData.customers.find(c => c.name === order.customer);
                    if (customer) {
                        const pointsToAdd = Math.floor(order.total * adminData.loyalty.pointsPerDollar);
                        customer.points += pointsToAdd;
                    }
                });
                
                // Marcar notificación como leída
                notification.read = true;
                
                showNotification('Cuenta marcada como pagada para la mesa ' + tableNumber, 'success');
                initOrdersSection();
            }
        }
        
        // Funciones para edición de platos
        function editDish(dishId) {
            const dish = adminData.dishes.find(d => d.id === dishId);
            if (!dish) return;
            
            editingDishId = dishId;
            
            const editForm = document.getElementById('editDishForm');
            editForm.innerHTML = `
                <div class="form-row">
                    <div class="form-group">
                        <label for="editDishName">Nombre del Plato</label>
                        <input type="text" id="editDishName" value="${dish.name}">
                    </div>
                    <div class="form-group">
                        <label for="editDishPrice">Precio</label>
                        <input type="number" id="editDishPrice" value="${dish.price}">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="editDishCategory">Categoría</label>
                        <select id="editDishCategory">
                            ${adminData.categories.map(cat => 
                                `<option value="${cat.id}" ${cat.id === dish.category ? 'selected' : ''}>${cat.name}</option>`
                            ).join('')}
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="editDishDescription">Descripción</label>
                    <textarea id="editDishDescription" rows="3">${dish.description}</textarea>
                </div>
                
                <div class="form-group">
                    <label>Etiquetas</label>
                    <div class="tags-container">
                        <div class="tag-checkbox">
                            <input type="checkbox" id="editTagVegetarian" value="vegetariano" ${dish.tags.includes('vegetariano') ? 'checked' : ''}>
                            <label for="editTagVegetarian">Vegetariano</label>
                        </div>
                        <div class="tag-checkbox">
                            <input type="checkbox" id="editTagVegan" value="vegano" ${dish.tags.includes('vegano') ? 'checked' : ''}>
                            <label for="editTagVegan">Vegano</label>
                        </div>
                        <div class="tag-checkbox">
                            <input type="checkbox" id="editTagGlutenFree" value="sin-gluten" ${dish.tags.includes('sin-gluten') ? 'checked' : ''}>
                            <label for="editTagGlutenFree">Sin Gluten</label>
                        </div>
                        <div class="tag-checkbox">
                            <input type="checkbox" id="editTagSpicy" value="picante" ${dish.tags.includes('picante') ? 'checked' : ''}>
                            <label for="editTagSpicy">Picante</label>
                        </div>
                        <div class="tag-checkbox">
                            <input type="checkbox" id="editTagLowCalorie" value="bajo-calorias" ${dish.tags.includes('bajo-calorias') ? 'checked' : ''}>
                            <label for="editTagLowCalorie">Bajo Calorías</label>
                        </div>
                    </div>
                </div>
            `;
            
            editDishModal.style.display = 'flex';
        }
        
        function saveDishEdit() {
            if (!editingDishId) return;
            
            const dish = adminData.dishes.find(d => d.id === editingDishId);
            if (!dish) return;
            
            // Obtener valores del formulario
            dish.name = document.getElementById('editDishName').value;
            dish.price = parseInt(document.getElementById('editDishPrice').value);
            dish.category = document.getElementById('editDishCategory').value;
            dish.description = document.getElementById('editDishDescription').value;
            
            // Obtener etiquetas seleccionadas
            dish.tags = [];
            if (document.getElementById('editTagVegetarian').checked) dish.tags.push('vegetariano');
            if (document.getElementById('editTagVegan').checked) dish.tags.push('vegano');
            if (document.getElementById('editTagGlutenFree').checked) dish.tags.push('sin-gluten');
            if (document.getElementById('editTagSpicy').checked) dish.tags.push('picante');
            if (document.getElementById('editTagLowCalorie').checked) dish.tags.push('bajo-calorias');
            
            // Cerrar modal y actualizar vista
            editDishModal.style.display = 'none';
            initMenuSection();
            showNotification('Plato actualizado correctamente', 'success');
            
            editingDishId = null;
        }
        
        // Funciones para guardar datos
        function saveRestaurantInfo() {
            adminData.restaurant.name = document.getElementById('restaurantName').value;
            adminData.restaurant.slogan = document.getElementById('restaurantSlogan').value;
            showNotification('Información del restaurant guardada correctamente', 'success');
        }
        
        function saveContactInfo() {
            adminData.restaurant.phone = document.getElementById('phone').value;
            adminData.restaurant.whatsapp = document.getElementById('whatsapp').value;
            adminData.restaurant.instagram = document.getElementById('instagram').value;
            adminData.restaurant.address = document.getElementById('address').value;
            showNotification('Información de contacto guardada correctamente', 'success');
        }
        
        function addHour() {
            adminData.restaurant.hours.push({day: '', time: ''});
            initRestaurantSection();
        }
        
        function saveHours() {
            const dayInputs = document.querySelectorAll('.hour-day');
            const timeInputs = document.querySelectorAll('.hour-time');
            
            adminData.restaurant.hours = [];
            
            dayInputs.forEach((input, index) => {
                adminData.restaurant.hours.push({
                    day: input.value,
                    time: timeInputs[index].value
                });
            });
            
            showNotification('Horarios guardados correctamente', 'success');
        }
        
        function addDish() {
            const singleForm = document.getElementById('singleDishForm');
            const multiForm = document.getElementById('multiDishForm');
            
            if (singleForm.style.display !== 'none') {
                // Agregar un solo plato
                const name = document.getElementById('dishName').value;
                const price = parseInt(document.getElementById('dishPrice').value);
                const category = document.getElementById('dishCategory').value;
                const description = document.getElementById('dishDescription').value;
                
                if (!name || !price || !category) {
                    showNotification('Por favor completa todos los campos obligatorios', 'error');
                    return;
                }
                
                // Obtener etiquetas seleccionadas
                const tags = [];
                if (document.getElementById('tagVegetarian').checked) tags.push('vegetariano');
                if (document.getElementById('tagVegan').checked) tags.push('vegano');
                if (document.getElementById('tagGlutenFree').checked) tags.push('sin-gluten');
                if (document.getElementById('tagSpicy').checked) tags.push('picante');
                if (document.getElementById('tagLowCalorie').checked) tags.push('bajo-calorias');
                
                const newDish = {
                    id: 'd' + (adminData.dishes.length + 1),
                    name,
                    price,
                    category,
                    description,
                    tags
                };
                
                adminData.dishes.push(newDish);
                showNotification('Plato agregado correctamente', 'success');
                
                // Limpiar formulario
                document.getElementById('dishName').value = '';
                document.getElementById('dishPrice').value = '';
                document.getElementById('dishDescription').value = '';
                document.getElementById('tagVegetarian').checked = false;
                document.getElementById('tagVegan').checked = false;
                document.getElementById('tagGlutenFree').checked = false;
                document.getElementById('tagSpicy').checked = false;
                document.getElementById('tagLowCalorie').checked = false;
            } else {
                // Agregar múltiples platos
                const dishNames = document.querySelectorAll('.multi-dish-name');
                const dishPrices = document.querySelectorAll('.multi-dish-price');
                const dishCategories = document.querySelectorAll('.multi-dish-category');
                const dishDescriptions = document.querySelectorAll('.multi-dish-description');
                
                let dishesAdded = 0;
                
                for (let i = 0; i < dishNames.length; i++) {
                    const name = dishNames[i].value;
                    const price = parseInt(dishPrices[i].value);
                    const category = dishCategories[i].value;
                    const description = dishDescriptions[i].value;
                    
                    if (name && price && category) {
                        // Obtener etiquetas seleccionadas para este plato
                        const tags = [];
                        if (document.querySelector(`.multi-tag-vegetarian[data-index="${i}"]`).checked) tags.push('vegetariano');
                        if (document.querySelector(`.multi-tag-vegan[data-index="${i}"]`).checked) tags.push('vegano');
                        if (document.querySelector(`.multi-tag-gluten-free[data-index="${i}"]`).checked) tags.push('sin-gluten');
                        if (document.querySelector(`.multi-tag-spicy[data-index="${i}"]`).checked) tags.push('picante');
                        if (document.querySelector(`.multi-tag-low-calorie[data-index="${i}"]`).checked) tags.push('bajo-calorias');
                        
                        const newDish = {
                            id: 'd' + (adminData.dishes.length + 1),
                            name,
                            price,
                            category,
                            description,
                            tags
                        };
                        
                        adminData.dishes.push(newDish);
                        dishesAdded++;
                    }
                }
                
                if (dishesAdded > 0) {
                    showNotification(`${dishesAdded} platos agregados correctamente`, 'success');
                    
                    // Limpiar formularios múltiples
                    dishNames.forEach(input => input.value = '');
                    dishPrices.forEach(input => input.value = '');
                    dishCategories.forEach(select => select.value = '');
                    dishDescriptions.forEach(textarea => textarea.value = '');
                    document.querySelectorAll('.multi-dish-preview').forEach(img => img.src = '');
                    document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => checkbox.checked = false);
                } else {
                    showNotification('No se agregaron platos. Completa al menos un formulario', 'warning');
                    return;
                }
            }
            
            initMenuSection();
        }
        
        function deleteDish(dishId) {
            if (confirm('¿Estás seguro de que quieres eliminar este plato?')) {
                adminData.dishes = adminData.dishes.filter(dish => dish.id !== dishId);
                initMenuSection();
                showNotification('Plato eliminado correctamente', 'success');
            }
        }
        
        function addCategory() {
            const name = document.getElementById('categoryName').value;
            const id = document.getElementById('categoryId').value;
            const parent = document.getElementById('parentCategory').value || null;
            
            if (!name || !id) {
                showNotification('Por favor completa todos los campos obligatorios', 'error');
                return;
            }
            
            // Verificar si el ID ya existe
            if (adminData.categories.some(cat => cat.id === id)) {
                showNotification('Ya existe una categoría con este ID', 'error');
                return;
            }
            
            const newCategory = {
                id,
                name,
                parent,
                order: adminData.categories.length
            };
            
            adminData.categories.push(newCategory);
            initCategoriesSection();
            initMenuSection(); // Actualizar selector de categorías en menú
            showNotification('Categoría agregada correctamente', 'success');
            
            // Limpiar formulario
            document.getElementById('categoryName').value = '';
            document.getElementById('categoryId').value = '';
            document.getElementById('parentCategory').value = '';
        }
        
        function editCategory(categoryId) {
            // Implementar edición de categoría
            showNotification('Funcionalidad de edición de categorías en desarrollo', 'warning');
        }
        
        function deleteCategory(categoryId) {
            // Verificar si hay platos usando esta categoría
            const dishesUsingCategory = adminData.dishes.filter(dish => dish.category === categoryId);
            
            if (dishesUsingCategory.length > 0) {
                showNotification('No puedes eliminar esta categoría porque hay platos que la usan', 'error');
                return;
            }
            
            // Verificar si hay subcategorías usando esta categoría como padre
            const subcategories = adminData.categories.filter(cat => cat.parent === categoryId);
            
            if (subcategories.length > 0) {
                showNotification('No puedes eliminar esta categoría porque tiene subcategorías', 'error');
                return;
            }
            
            if (confirm('¿Estás seguro de que quieres eliminar esta categoría?')) {
                adminData.categories = adminData.categories.filter(cat => cat.id !== categoryId);
                initCategoriesSection();
                initMenuSection(); // Actualizar selector de categorías en menú
                showNotification('Categoría eliminada correctamente', 'success');
            }
        }
        
        function addTable() {
            const number = document.getElementById('tableNumber').value;
            const sector = document.getElementById('tableSector').value;
            const capacity = parseInt(document.getElementById('tableCapacity').value);
            
            if (!number || !sector || !capacity) {
                showNotification('Por favor completa todos los campos obligatorios', 'error');
                return;
            }
            
            // Verificar si el número de mesa ya existe
            if (adminData.tables.some(table => table.number === number)) {
                showNotification('Ya existe una mesa con este número', 'error');
                return;
            }
            
            const newTable = {
                id: 't' + (adminData.tables.length + 1),
                number,
                sector,
                capacity
            };
            
            adminData.tables.push(newTable);
            initTablesSection();
            showNotification('Mesa agregada correctamente', 'success');
            
            // Limpiar formulario
            document.getElementById('tableNumber').value = '';
            document.getElementById('tableCapacity').value = '';
        }
        
        function editTable(tableId) {
            // Implementar edición de mesa
            showNotification('Funcionalidad de edición de mesas en desarrollo', 'warning');
        }
        
        function deleteTable(tableId) {
            if (confirm('¿Estás seguro de que quieres eliminar esta mesa?')) {
                adminData.tables = adminData.tables.filter(table => table.id !== tableId);
                initTablesSection();
                showNotification('Mesa eliminada correctamente', 'success');
            }
        }
        
        function saveLoyaltyConfig() {
            adminData.loyalty.pointsPerDollar = parseFloat(document.getElementById('pointsPerDollar').value);
            adminData.loyalty.pointsForReward = parseInt(document.getElementById('pointsForReward').value);
            showNotification('Configuración de fidelidad guardada correctamente', 'success');
        }
        
        function addReward() {
            const name = document.getElementById('rewardName').value;
            const points = parseInt(document.getElementById('rewardPoints').value);
            const description = document.getElementById('rewardDescription').value;
            
            if (!name || !points || !description) {
                showNotification('Por favor completa todos los campos obligatorios', 'error');
                return;
            }
            
            const newReward = {
                id: 'r' + (adminData.rewards.length + 1),
                name,
                points,
                description
            };
            
            adminData.rewards.push(newReward);
            initCustomersSection();
            showNotification('Premio agregado correctamente', 'success');
            
            // Limpiar formulario
            document.getElementById('rewardName').value = '';
            document.getElementById('rewardPoints').value = '';
            document.getElementById('rewardDescription').value = '';
        }
        
        function editReward(rewardId) {
            // Implementar edición de premio
            showNotification('Funcionalidad de edición de premios en desarrollo', 'warning');
        }
        
        function deleteReward(rewardId) {
            if (confirm('¿Estás seguro de que quieres eliminar este premio?')) {
                adminData.rewards = adminData.rewards.filter(reward => reward.id !== rewardId);
                initCustomersSection();
                showNotification('Premio eliminado correctamente', 'success');
            }
        }
        
        function editCustomer(customerId) {
            // Implementar edición de cliente
            showNotification('Funcionalidad de edición de clientes en desarrollo', 'warning');
        }
        
        function deleteCustomer(customerId) {
            if (confirm('¿Estás seguro de que quieres eliminar este cliente?')) {
                adminData.customers = adminData.customers.filter(customer => customer.id !== customerId);
                initCustomersSection();
                showNotification('Cliente eliminado correctamente', 'success');
            }
        }
        
        function completeOrder(orderId) {
            const order = adminData.orders.find(o => o.id === orderId);
            if (order) {
                order.status = 'completed';
                initOrdersSection();
                showNotification('Pedido marcado como completado', 'success');
            }
        }
        
        function cancelOrder(orderId) {
            if (confirm('¿Estás seguro de que quieres cancelar este pedido?')) {
                const order = adminData.orders.find(o => o.id === orderId);
                if (order) {
                    order.status = 'cancelled';
                    initOrdersSection();
                    showNotification('Pedido cancelado', 'success');
                }
            }
        }
        
        function markNotificationAsRead(notificationId) {
            const notification = adminData.notifications.find(n => n.id === notificationId);
            if (notification) {
                notification.read = true;
                
                // Si es una llamada al mozo, mostrar notificación al cliente
                if (notification.type === 'call') {
                    showNotification('El mozo ha sido notificado y se dirige a la mesa', 'success');
                }
                
                initOrdersSection();
                showNotification('Notificación marcada como leída', 'success');
            }
        }
        
        function saveTopCustomers() {
            adminData.topCustomers.frequent.name = document.getElementById('frequentName').value;
            adminData.topCustomers.frequent.color = document.getElementById('frequentColor').value;
            adminData.topCustomers.vip.name = document.getElementById('vipName').value;
            adminData.topCustomers.vip.color = document.getElementById('vipColor').value;
            adminData.topCustomers.new.name = document.getElementById('newName').value;
            adminData.topCustomers.new.color = document.getElementById('newColor').value;
            
            showNotification('Configuración de top clientes guardada correctamente', 'success');
        }
    </script>
<!-- 🔐 Envío de platos a Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBSTjM-uPnnqIvcDBkpf71yxF6ajga1db0",
    authDomain: "patagoniarestaurant-783c3.firebaseapp.com",
    projectId: "patagoniarestaurant-783c3",
    storageBucket: "patagoniarestaurant-783c3.firebasestorage.app",
    messagingSenderId: "303237107477",
    appId: "1:303237107477:web:67591dad3e4244d434a31c"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // 🎯 Cuando tocás el botón Agregar Plato
  const btn = document.getElementById("addDishBtn");
  btn.addEventListener("click", () => {
    const idioma = document.getElementById("adminLanguage").value;
    const nombre = document.getElementById("dishName").value;
    const descripcion = document.getElementById("dishDescription").value;
    const precio = document.getElementById("dishPrice").value;

    const menuRef = ref(db, "menu/" + idioma);
    const nuevo = push(menuRef);

    set(nuevo, { nombre, descripcion, precio })
      .then(() => alert("✅ Plato guardado y actualizado en vivo"))
      .catch((err) => alert("⚠️ Error: " + err));
  });
</script>
</body>
</html>